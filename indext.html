<!DOCTYPE html>
<html>

<head>
  <title>Input Transaksi Kasir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #f5f5f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #form-container {
      width: 500px;
      margin: 30px auto;
      background-color: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .input-group {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      margin-bottom: 10px;
    }

    .input-group .form-group {
      flex: 1;
    }

    .remove-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      height: 38px;
      margin-bottom: 20px;
    }

    .remove-btn:hover {
      background-color: #c0392b;
    }

    button {
      width: 100%;
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2980b9;
    }

    .receipt-preview {
      margin-top: 20px;
      border-top: 1px dashed #ccc;
      padding-top: 15px;
    }

    #loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    #loading div {
      background: #fff;
      padding: 20px 30px;
      border-radius: 8px;
      font-size: 18px;
    }

    @media (max-width: 600px) {
      #form-container {
        width: 90%;
      }

      .input-group {
        flex-direction: column;
      }

      .remove-btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div id="form-container">
    <h2>Transaksi Kasir</h2>
    <form id="kasirForm">
      <div class="form-group">
        <label for="nama_pelanggan">Nama Pelanggan</label>
        <input type="text" id="nama_pelanggan" name="nama_pelanggan" required>
      </div>

  <div class="form-group">
    <label for="nama_kasir">Nama Kasir</label>
    <select id="nama_kasir" name="nama_kasir" required>
      <option value="">-- Pilih Kasir --</option>
      <option value="fathu">Fathu</option>
      <option value="aziz">Aziz</option>
      <option value="wibawa">Wibawa</option>
      <option value="mbuh">Mbuh</option>
    </select>
  </div>

      <label>Menu Pesanan</label>
      <div id="menu-container"></div>
      <button type="button" onclick="addMenu()">+ Tambah Menu</button>

      <div class="form-group">
        <label for="total">Total Harga</label>
        <input type="text" id="total" name="total" readonly>
      </div>

      <div class="input-group">
        <div class="form-group">
          <label for="bayar">Bayar</label>
          <input type="number" id="bayar" name="bayar" min="0" required>
        </div>
        <div class="form-group">
          <label for="kembali">Kembalian</label>
          <input type="text" id="kembali" name="kembali" readonly>
        </div>
      </div>

      <button type="submit">Simpan Transaksi</button>

      <div class="receipt-preview">
        <h3>Struk</h3>
        <div id="receipt-content"></div>
      </div>
    </form>
  </div>

  <div id="loading">
    <div>Menyimpan transaksi...</div>
  </div>

  <script>
    const menuList = [
      { nama: "Roti Bakar Keju", harga: 10000 },
      { nama: "Roti Bakar Coklat", harga: 15000 }
    ];

    document.getElementById("bayar").addEventListener("input", calculateChange);

    function addMenu() {
      const container = document.getElementById("menu-container");
      const div = document.createElement("div");
      div.className = "input-group";
      div.innerHTML = `
        <div class="form-group">
          <select class="menu-select" required>
            <option value="">-- Pilih Menu --</option>
            ${menuList.map(menu => `<option value="${menu.nama}" data-harga="${menu.harga}">${menu.nama}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <input type="number" class="menu-jumlah" placeholder="Jumlah" min="1" required>
        </div>
        <button type="button" class="remove-btn" onclick="removeMenu(this)">Batal</button>
      `;
      container.appendChild(div);

      div.querySelectorAll("select, input").forEach(el => {
        el.addEventListener("input", calculateTotal);
      });
    }

    function removeMenu(button) {
      const menuItem = button.parentNode;
      menuItem.remove();
      calculateTotal();
    }

    function formatRupiah(angka) {
      return parseFloat(angka).toLocaleString("id-ID");
    }

    function calculateTotal() {
      let total = 0;
      document.querySelectorAll("#menu-container .input-group").forEach(group => {
        const select = group.querySelector(".menu-select");
        const harga = parseFloat(select.selectedOptions[0]?.dataset.harga || 0);
        const jumlah = parseInt(group.querySelector(".menu-jumlah").value) || 0;
        total += harga * jumlah;
      });
      document.getElementById("total").value = formatRupiah(total);
      calculateChange();
    }

    function calculateChange() {
      const totalStr = document.getElementById("total").value.replace(/\./g, '').replace(',', '.');
      const total = parseFloat(totalStr) || 0;
      const bayar = parseFloat(document.getElementById("bayar").value) || 0;
      const kembali = bayar - total;
      document.getElementById("kembali").value = kembali >= 0 ? formatRupiah(kembali) : "0";
    }

    function showLoading() {
      document.getElementById("loading").style.display = "flex";
    }

    function hideLoading() {
      document.getElementById("loading").style.display = "none";
    }

    document.getElementById("kasirForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const kasir = document.getElementById("nama_kasir").value;
      if (!kasir) {
        alert("Silakan pilih nama kasir.");
        return;
      }

      const menuItems = [];
      let valid = true;

      document.querySelectorAll("#menu-container .input-group").forEach(group => {
        const select = group.querySelector(".menu-select");
        const jumlah = group.querySelector(".menu-jumlah").value;
        if (select.value && jumlah > 0) {
          menuItems.push({
            nama: select.value,
            jumlah: parseInt(jumlah)
          });
        } else {
          valid = false;
        }
      });

      if (menuItems.length === 0 || !valid) {
        alert("Minimal satu menu harus dipilih dan jumlah harus diisi.");
        return;
      }

      const formData = new FormData();
      formData.append("nama_pelanggan", document.getElementById("nama_pelanggan").value);
      formData.append("nama_kasir", kasir);
      formData.append("total", document.getElementById("total").value.replace(/\./g, '').replace(',', '.'));
      formData.append("bayar", document.getElementById("bayar").value);
      formData.append("kembali", document.getElementById("kembali").value.replace(/\./g, '').replace(',', '.'));
      formData.append("menu_list", JSON.stringify(menuItems));

      showLoading();

      fetch("https://script.google.com/macros/s/AKfycbypLgl92sfguQ1hh5DBEsBy6mSSwAElegtgqY-Jvk8r1z4tYUJBTlnqMFECj1uSxNjcGw/exec", {
        method: "POST",
        body: formData
      })
        .then(response => response.json())
        .then(data => {
          hideLoading();
          if (data.status === "success") {
            alert("Transaksi sudah disimpan!, jangan lupa laporan setelah selesai sift ya");
            location.reload();
          } else {
            alert("Gagal menyimpan transaksi., cek koneksi mu siapa tau itu penyebab nya");
          }
        })
        .catch(error => {
          hideLoading();
          alert("Error: " + error);
        });
    });

    // Tambah menu default
    addMenu();
  </script>
</body>

</html>
